<h2>Checkout</h2>

<div class="checkout-form">

  <label>
    Adresă livrare:
    <select [(ngModel)]="deliveryAddressId">
      <option [ngValue]="undefined" disabled selected>— alege adresă —</option>
      <option *ngFor="let a of addresses" [ngValue]="a.id">
        {{ a.name }} — {{ a.city }}, {{ a.street }} ({{ a.zipCode }})
      </option>
    </select>
  </label>

  <label>
    Adresă utilizator (facturare):
    <select [(ngModel)]="userAddressId">
      <option [ngValue]="undefined">— aceeași ca livrare —</option>
      <option *ngFor="let a of addresses" [ngValue]="a.id">
        {{ a.city }}, {{ a.street }} ({{ a.zipCode }})
      </option>
    </select>
  </label>

  <button (click)="placeOrder()">Trimite comanda</button>

  <!-- deschide formular adresă nouă -->
  <button type="button" class="secondary" (click)="toggleNewAddressForm()">
    Adaugă adresă nouă
  </button>
</div>

<!-- Formular adresă nouă -->
<div class="new-address" *ngIf="showNewAddressForm">
  <h3>Adresă nouă</h3>

  <div class="new-address-grid">

    <label>
      Nume adresă:
      <input type="text" [(ngModel)]="newAddress.name" name="newName" placeholder="Ex: Acasă, Birou">
    </label>

    <label>
      Țară:
      <input type="text" [(ngModel)]="newAddress.country" name="newCountry">
    </label>

    <label>
      Oraș:
      <input type="text" [(ngModel)]="newAddress.city" name="newCity">
    </label>

    <label>
      Stradă:
      <input type="text" [(ngModel)]="newAddress.street" name="newStreet">
    </label>

    <label>
      Cod poștal:
      <input type="text" [(ngModel)]="newAddress.zipCode" name="newZip">
    </label>
  </div>

  <div class="new-address-actions">
    <button type="button" (click)="saveNewAddress()">Salvează adresa</button>
    <button type="button" (click)="toggleNewAddressForm()">Renunță</button>
  </div>
</div>


<div class="checkout-summary">
  <div class="checkout-summary">
    <h3>Rezumat coș:</h3>

    <div *ngIf="cart.lines.length; else emptyCart" class="checkout-lines">

      <div class="checkout-line" *ngFor="let item of cart.lines">

        <!-- stânga: nume + detalii -->
        <div class="line-info">
          <span class="product-name">{{ item.product.name }}</span>
          <span class="product-details">
          — x {{ item.quantity }} buc.
          ( {{ item.product.price || 0 | number:'1.2-2' }} lei / buc.)
        </span>
        </div>

        <!-- dreapta: butoane - + Șterge pe un singur rând -->
        <div class="line-actions">
          <button type="button" (click)="dec(item)">−</button>
          <span class="qty">{{ item.quantity }}</span>
          <button type="button" (click)="inc(item)">+</button>

          <button
            type="button"
            class="delete-btn"
            (click)="remove(item)">
            Șterge
          </button>
        </div>

      </div>

    </div>

    <ng-template #emptyCart>
      <p>Coșul este gol.</p>
    </ng-template>

    <p class="checkout-total">
      <strong>Total:</strong>
      {{ cart.total | number:'1.0-0' }} lei
    </p>
  </div>
